<!DOCTYPE html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Distillery Control Page</title>
    {{ CSS }}
</head>

<body>
    <header>
        <h1 id="top">Distillery Control Page</h1>
        <small>Generated at <code class="date">{{ .Time.Format "2006-01-02T15:04:05Z07:00" }}</code></small>
        <p>
            <a class="pure-button pure-button-primary" href="/dis/index">Control</a>
        </p>
        <p>
            <a class="pure-button" href="/dis/components">Components</a>
        </p>
    </header>
    <main>
        <div class="pure-g">
            <div class="pure-u-1-1">
                <h2 id="overview">Distillery Configuration</h2>
            </div>
            <div class="pure-u-1 pure-u-xl-1-3">
                <div class="padding">
                    <div class="overflow">
                        <table class="pure-table pure-table-bordered">
                            <thead>
                                <tr>
                                    <th colspan="2">
                                        Domains
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        Primary
                                    </td>
                                    <td>
                                        <code>{{.Config.DefaultDomain}}</code>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Extra
                                    </td>
                                    <td>
                                        {{ range .Config.SelfExtraDomains }}
                                        <code>{{.}}</code><br />
                                        {{ end }}
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Email <small>(HTTPS)</small>
                                    </td>
                                    <td>
                                        <code>{{.Config.CertbotEmail}}</code>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="pure-u-1 pure-u-xl-1-3">
                <div class="padding">
                    <div class="overflow">
                        <table class="pure-table pure-table-bordered">
                            <thead>
                                <tr>
                                    <th colspan="2">
                                        Database Settings
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        MySQL User Prefix
                                    </td>
                                    <td>
                                        <code>{{.Config.MysqlUserPrefix}}</code>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        MySQL Database Prefix
                                    </td>
                                    <td>
                                        <code>{{.Config.MysqlDatabasePrefix}}</code>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        GraphDB User Prefix
                                    </td>
                                    <td>
                                        <code>{{.Config.GraphDBUserPrefix}}</code>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        GraphDB Database Prefix
                                    </td>
                                    <td>
                                        <code>{{.Config.GraphDBRepoPrefix}}</code>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Bookkeeping Database
                                    </td>
                                    <td>
                                        <code>{{.Config.DistilleryDatabase}}</code>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="pure-u-1 pure-u-xl-1-3">
                <div class="padding">
                    <div class="overflow">
                        <table class="pure-table pure-table-bordered">
                            <thead>
                                <tr>
                                    <th colspan="2">
                                        Directory Settings
                                    </th>
                                </tr>
                            </thead>

                            <tbody>
                                <tr>
                                    <td>
                                        <code>root</code>
                                    </td>
                                    <td>
                                        <code>{{.Config.DeployRoot}}</code>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <code>config</code>
                                    </td>
                                    <td>
                                        <code>{{.Config.ConfigPath}}</code>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <code>authorized_keys</code>
                                    </td>
                                    <td>
                                        <code>{{.Config.GlobalAuthorizedKeysFile}}</code>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="pure-u-1 pure-u-xl-2-5">
                <div class="padding">
                    <div class="overflow">
                        <table class="pure-table pure-table-bordered">
                            <thead>
                                <tr>
                                    <th colspan="2">
                                        Misc Settings
                                    </th>
                                </tr>
                            </thead>

                            <tbody>
                                <tr>
                                    <td>
                                        Homepage
                                    </td>
                                    <td>
                                        <a href="{{.Config.SelfRedirect}}" target="_blank" rel="noopener noreferrer">{{.Config.SelfRedirect}}</a>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Docker Network Name
                                    </td>
                                    <td>
                                        <code>{{.Config.DockerNetworkName}}</code>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Backup Age
                                    </td>
                                    <td>
                                        <code>{{.Config.MaxBackupAge}}</code> Day(s)
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="pure-u-1-1">
                <h2 id="backups">Backups</h2>
            </div>

            <div class="pure-u-1">
                <table class="pure-table pure-table-bordered padding">
                    <thead>
                        <tr>
                            <th>Path</th>
                            <th>Created</th>
                            <th>Packed</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{ range .Backups }}
                        <tr>
                            <td>
                                <code class="path">{{ .Path }}</code>
                            </td>
                            <td>
                                <code class="date">{{ .Created.Format "2006-01-02T15:04:05Z07:00" }}</code>
                            </td>
                            <td>
                                {{ .Packed }}
                            </td>
                        </tr>
                        {{ end}}
                    </tbody>
                </table>
            </div>

            <div class="pure-u-1">
                <h2 id="instances">Instances</h2>

                <table class="pure-table pure-table-bordered padding">
                    <thead>
                        <tr>
                            <th>Total</th>
                            <th>Running</th>
                            <th>Stopped</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                {{ .TotalCount }}
                            </td>
                            <td>
                                {{ .RunningCount }}
                            </td>
                            <td>
                                {{ .StoppedCount }}
                            </td>
                        </tr>
                    </tbody>
                </table>

                <span class="hspace"></span>
            </div>

            {{range .Instances}}
            <div class="pure-u-1 pure-u-xl-1-3">
                <div class="wisski {{ if .Running }}running{{ else }}stopped{{ end }}">
                    <h3>
                        {{.Slug}}
                        {{ if not .Running }}&nbsp;<small>not running</small>{{ end }}
                    </h3>
                    <p>
                        <a href="{{.URL}}" target="_blank" rel="noopener noreferrer">{{.URL}}</a><br>

                        <a class="pure-button" href="/dis/instance/{{.Slug}}">Details</a>
                    </p>
                </div>
            </div>
            {{end}}

        </div>
    </main>

    <footer>
        Generated at <code>{{ .Time }}</code>
    </footer>

    {{ JS }}
</body>